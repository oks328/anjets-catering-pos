{% extends "admin_base.html" %}

{% block title %}Rider Application Details{% endblock %}

{% block content %}
    <a href="{{ url_for('admin_rider_verifications') }}" class="btn btn-secondary" style="margin-bottom: 1rem;">
        &larr; Back to Verifications
    </a>
    <h2>Application Details for: {{ rider.name }}</h2>

    <div class="card">
        <h3>Rider Information</h3>
        {# Ensure the 'today' variable is used for age calculation #}
        <table class="admin-table" style="width: auto;">
            <tr>
                <td><strong>Application Status:</strong></td>
                <td>
                    {% if rider.application_status == 'Approved' %}
                        <span style="color: #28a745; font-weight: bold;">Approved</span>
                    {% elif rider.application_status == 'Denied' %}
                        <span style="color: #dc3545; font-weight: bold;">Denied</span>
                    {% else %}
                        <span style="color: #ffc107; font-weight: bold;">Pending</span>
                    {% endif %}
                </td>
            </tr>
            <tr><td><strong>Birthdate:</strong></td><td>{{ rider.birthdate.strftime('%Y-%m-%d') if rider.birthdate else 'N/A' }}</td></tr>
            {# Age calculation now safely relies on the 'today' variable passed from the route #}
            <tr><td><strong>Age:</strong></td><td>{{ (today.year - rider.birthdate.year) - ( (today.month, today.day) < (rider.birthdate.month, rider.birthdate.day) ) if rider.birthdate else 'N/A' }}</td></tr>
            <tr><td><strong>Contact:</strong></td><td>{{ rider.contact_number }}</td></tr>
        </table>
    </div>

    <div class="card">
        <h3>Uploaded Documents (Click image to view full-size)</h3>
        <p>The files are stored in <code>/app/static/uploads/riders/documents/</code>.</p>

        <div class="product-grid" style="grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));">
            
            <div class="product-card" style="border: 1px solid #ccc;">
                <h4>1. Driver's License</h4>
                {% if rider.license_file %}
                <a href="{{ url_for('static', filename='uploads/' + rider.license_file) }}" target="_blank">
                    <img src="{{ url_for('static', filename='uploads/' + rider.license_file) }}" style="width: 100%; height: auto; border-radius: 4px;">
                </a>
                {% else %}
                <p style="color: #dc3545; text-align: center; padding: 2rem;">File not submitted or missing.</p>
                {% endif %}
            </div>

            <div class="product-card" style="border: 1px solid #ccc;">
                <h4>2. Government-Issued ID</h4>
                {% if rider.govt_id_file %}
                <a href="{{ url_for('static', filename='uploads/' + rider.govt_id_file) }}" target="_blank">
                    <img src="{{ url_for('static', filename='uploads/' + rider.govt_id_file) }}" style="width: 100%; height: auto; border-radius: 4px;">
                </a>
                {% else %}
                <p style="color: #dc3545; text-align: center; padding: 2rem;">File not submitted or missing.</p>
                {% endif %}
            </div>

            <div class="product-card" style="border: 1px solid #ccc;">
                <h4>3. Vehicle OR/CR</h4>
                {% if rider.or_cr_file %}
                <a href="{{ url_for('static', filename='uploads/' + rider.or_cr_file) }}" target="_blank">
                    <img src="{{ url_for('static', filename='uploads/' + rider.or_cr_file) }}" style="width: 100%; height: auto; border-radius: 4px;">
                </a>
                {% else %}
                <p style="color: #dc3545; text-align: center; padding: 2rem;">File not submitted or missing.</p>
                {% endif %}
            </div>

            <div class="product-card" style="border: 1px solid #ccc;">
                <h4>4. NBI Clearance</h4>
                {% if rider.nbi_clearance_file %}
                <a href="{{ url_for('static', filename='uploads/' + rider.nbi_clearance_file) }}" target="_blank">
                    <img src="{{ url_for('static', filename='uploads/' + rider.nbi_clearance_file) }}" style="width: 100%; height: auto; border-radius: 4px;">
                </a>
                {% else %}
                <p style="color: #dc3545; text-align: center; padding: 2rem;">File not submitted or missing.</p>
                {% endif %}
            </div>
        </div>
        
        <hr>

        <div style="text-align: right; margin-top: 2rem;">
            <form method="POST" action="{{ url_for('admin_approve_rider', rider_id=rider.rider_id) }}" style="display:inline;">
                <input type="submit" value="Final Approve" class="btn btn-success" style="font-size: 1.1rem; padding: 0.75rem 1.5rem;">
            </form>
            <form method="POST" action="{{ url_for('admin_deny_rider', rider_id=rider.rider_id) }}" style="display:inline;">
                <input type="submit" value="Final Deny" class="btn btn-danger" style="font-size: 1.1rem; padding: 0.75rem 1.5rem;">
            </form>
        </div>
    </div>
{% endblock %}