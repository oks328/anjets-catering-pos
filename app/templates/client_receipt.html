{% extends "base.html" %}

{% block title %}Order Receipt #{{ order.order_id }}{% endblock %}

{% block content %}
<div class="receipt-container"
    style="max-width: 600px; margin: 2rem auto; padding: 20px; background: white; box-shadow: 0 0 10px rgba(0,0,0,0.1);">
    <h1 style="text-align: center; border-bottom: 2px solid #333; padding-bottom: 10px; margin-bottom: 20px;">
        Anjet's Receipt
    </h1>

    <div class="receipt-header">
        <p><strong>Order ID:</strong> #{{ order.order_id }}</p>
        <p><strong>Date:</strong> {{ order.order_date.strftime('%Y-%m-%d %I:%M %p') }}</p>
        <p><strong>Customer:</strong> {{ order.customer.name }}</p>
        <p style="margin-bottom: 20px;">
            <strong>Status:</strong> <span style="color: green; font-weight: bold;">{{ order.status }}</span>
        </p>
    </div>

    <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
        <thead>
            <tr style="border-bottom: 1px solid #ddd;">
                <th style="text-align: left; padding: 8px;">Item</th>
                <th style="padding: 8px;">Qty</th>
                <th style="text-align: right; padding: 8px;">Price</th>
                <th style="text-align: right; padding: 8px;">Subtotal</th>
            </tr>
        </thead>
        <tbody>
            {% for item in order.items %}
            <tr style="border-bottom: 1px dotted #eee;">
                <td style="text-align: left; padding: 8px;">
                    {{ item.product.name }} ({{ item.variant.size_name }})
                </td>
                <td style="text-align: center; padding: 8px;">{{ item.quantity }}</td>
                <td style="text-align: right; padding: 8px;">₱{{ "%.2f"|format(item.price_per_item) }}</td>
                <td style="text-align: right; padding: 8px;">₱{{ "%.2f"|format(item.price_per_item * item.quantity) }}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="receipt-totals" style="text-align: right;">
        <p>Subtotal: ₱{{ "%.2f"|format(order.total_amount) }}</p>
        
        {% if order.discount_amount > 0 %}
            <p style="color: #dc3545;">Discount: - ₱{{ "%.2f"|format(order.discount_amount) }}</p>
        {% endif %}
        
        {% if order.vat_amount > 0 %}
            <p style="font-weight: bold;">VAT (12%): + ₱{{ "%.2f"|format(order.vat_amount) }}</p>
        {% endif %}

        {% if order.delivery_fee > 0 %}
            <p>Delivery Fee: ₱{{ "%.2f"|format(order.delivery_fee) }}</p>
        {% endif %}
        
        <h3 style="border-top: 2px dashed #333; padding-top: 10px; margin-top: 10px;">
            Total Paid: ₱{{ "%.2f"|format(order.final_amount) }}
        </h3>
    </div>

    <div class="receipt-actions" style="text-align: center; margin-top: 30px;">
        <a href="{{ url_for('client_orders') }}" class="btn btn-secondary"
            style="background-color: #6c757d; color: white; border: none; margin-right: 1rem;">
            &larr; Back to Orders
        </a>

        <button onclick="window.print()" class="btn btn-primary" style="border: none;">
            <i class="fa-solid fa-print"></i> Print Receipt
        </button>
    </div>

</div>
{% endblock %}

{% block styles %}
{{ super() }}
<style>
    /* Hide header, footer, and navigation when printing */
    @media print {
        .client-header,
        .client-footer,
        .account-nav,
        .receipt-actions, /* Hide the buttons themselves */
        button {
            display: none !important;
        }

        .receipt-container {
            box-shadow: none !important;
            border: none !important;
            max-width: 100% !important;
            width: 100% !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        main {
            padding: 0 !important;
        }
        
        body {
            background-color: white;
        }
    }
</style>
{% endblock %}