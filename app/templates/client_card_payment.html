{% extends "base.html" %}

{% block title %}Card Payment{% endblock %}

{% block content %}
<div class="form-container">
    <div class="form-wrapper">
        <h2 style="color: var(--brand-red);">Credit/Debit Card Payment</h2>
        <p style="text-align: center; margin-bottom: 2rem;">
            Enter your card details to complete the payment securely.
        </p>
        
        <div class="card" style="background: #f8f9fa; border: 1px solid #dee2e6; padding: 1.5rem; margin-bottom: 2rem; text-align: center;">
            <p style="font-size: 1.1rem; margin-bottom: 0.5rem; font-weight: 500;">
                Amount Due: <strong style="font-size: 1.5rem; color: var(--brand-red);">â‚±{{ "%.2f"|format(final_total) }}</strong>
            </p>
            <p style="font-size: 0.85rem; color: #6c757d; margin-top: 1rem;">
                <i class="fa fa-lock"></i> Your card information is secure and will not be stored.
            </p>
        </div>

        <form method="POST" action="{{ url_for('client_card_payment') }}" novalidate>
            {{ form.hidden_tag() }}
            
            <div class="form-group">
                {{ form.card_number.label }}
                {{ form.card_number(class="form-control", placeholder="1234 5678 9012 3456", maxlength="23") }}
                {% if form.card_number.description %}
                    <small class="form-text text-muted">{{ form.card_number.description }}</small>
                {% endif %}
                {% for error in form.card_number.errors %}
                    <span class="error-message">{{ error }}</span>
                {% endfor %}
            </div>
            
            <div class="form-group">
                {{ form.card_holder_name.label }}
                {{ form.card_holder_name(class="form-control", placeholder="JUAN DELA CRUZ", style="text-transform: uppercase;") }}
                {% if form.card_holder_name.description %}
                    <small class="form-text text-muted">{{ form.card_holder_name.description }}</small>
                {% endif %}
                {% for error in form.card_holder_name.errors %}
                    <span class="error-message">{{ error }}</span>
                {% endfor %}
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                <div class="form-group">
                    {{ form.expiry_month.label }}
                    {{ form.expiry_month(class="form-control") }}
                    {% for error in form.expiry_month.errors %}
                        <span class="error-message">{{ error }}</span>
                    {% endfor %}
                </div>
                <div class="form-group">
                    {{ form.expiry_year.label }}
                    {{ form.expiry_year(class="form-control") }}
                    {% for error in form.expiry_year.errors %}
                        <span class="error-message">{{ error }}</span>
                    {% endfor %}
                </div>
                <div class="form-group">
                    {{ form.cvv.label }}
                    {{ form.cvv(class="form-control", placeholder="123", maxlength="4") }}
                    {% for error in form.cvv.errors %}
                        <span class="error-message">{{ error }}</span>
                    {% endfor %}
                </div>
            </div>

            <div class="form-group" style="margin-top: 2rem;">
                {{ form.submit(class="btn btn-primary") }}
            </div>
            
            <div style="text-align: center; margin-top: 1.5rem;">
                <a href="{{ url_for('client_checkout_options') }}" style="color: var(--text-gray); text-decoration: none;">
                    <i class="fa fa-arrow-left"></i> Back to Payment Options
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Auto-format card number with spaces every 4 digits
document.addEventListener('DOMContentLoaded', function() {
    const cardNumberInput = document.querySelector('input[name="card_number"]');
    
    if (cardNumberInput) {
        cardNumberInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\s/g, '');
            let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
            e.target.value = formattedValue;
        });
    }
    
    // Auto-uppercase cardholder name
    const cardHolderInput = document.querySelector('input[name="card_holder_name"]');
    if (cardHolderInput) {
        cardHolderInput.addEventListener('input', function(e) {
            e.target.value = e.target.value.toUpperCase();
        });
    }
});
</script>
{% endblock %}
