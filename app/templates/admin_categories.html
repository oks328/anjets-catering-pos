{% extends "admin_base.html" %}

{% block title %}Manage Categories{% endblock %}

{% block content %}
    <h2>Manage Menu Categories</h2>

    <div class="card" id="add-category-card">
        <h3>Add New Category</h3>
        <form method="POST" action="{{ url_for('admin_add_category') }}" novalidate>
            {{ add_form.hidden_tag() }} 
            
            <div class="form-group">
                {{ add_form.name.label(text="Category Name") }}
                {{ add_form.name(class="form-control", placeholder="Enter category name") }}
                {% for error in add_form.name.errors %}
                    <span class="error-message">{{ error }}</span>
                {% endfor %}
            </div>

            <div class="form-group">
                {{ add_form.description.label }}
                {{ add_form.description(class="form-control", placeholder="Enter category description", rows=4) }}
            </div>

            <div class="form-group" style="margin-top: 1.5rem;">
                {{ add_form.submit(class="btn btn-primary") }}
            </div>
        </form>
    </div>

<div class="card" id="existing-categories-card">
    
    <form method="GET" action="{{ url_for('admin_categories') }}#existing-categories-card" class="search-form">
        <input type="text" name="search" class="form-control" placeholder="Search categories..." value="{{ search_query or '' }}">
        <button type="submit" class="btn btn-primary">Search</button>
    </form>

    <hr style="margin-top: 1.5rem; margin-bottom: 1.5rem; border: none; border-top: 1px solid var(--border-gray);">

    <h3>Existing Categories</h3>
    <table class="admin-table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Description</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for category in categories %}
            <tr>
                <form method="POST" action="{{ url_for('admin_edit_category', category_id=category.category_id) }}" novalidate>
                    {{ edit_form.hidden_tag() }}
                    <td>
                        {{ edit_form.name(class="form-control", value=category.name) }}
                    </td>
                    <td>
                        <textarea name="description" 
      class="form-control" 
      id="description-{{ category.category_id }}"
>{{ category.description or '' }}</textarea>
                    </td>
                    <td class="action-buttons">
                        {{ edit_form.submit(class="btn btn-secondary", value="Update") }}
                </form> 
                
                <form method="POST" action="{{ url_for('admin_toggle_category_status', category_id=category.category_id) }}" style="display:inline;">
                    {% if category.is_active %}
                        <input type="submit" value="Deactivate" class="btn btn-danger">
                    {% else %}
                        <input type="submit" value="Activate" class="btn btn-success">
                    {% endif %}
                </form>
                    </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="3">No categories found. Add one above!</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}