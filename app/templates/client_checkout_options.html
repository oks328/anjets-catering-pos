{% extends "base.html" %}

{% block title %}Checkout - Step 1{% endblock %}

{% block content %}
<div class="checkout-options-container">
    <h2>How would you like to receive your order?</h2>

    <form action="{{ url_for('save_checkout_options') }}" method="POST">
        
        <label class="option-card">
            <input type="radio" name="order_type" value="Pickup" checked 
                   onchange="toggleAddressForm()">
            <div class="option-info">
                <span class="option-title">Store Pickup</span>
                <span class="option-desc">Pick up your order at our location. No additional fees.</span>
            </div>
        </label>

        <label class="option-card">
            <input type="radio" name="order_type" value="Delivery"
                   onchange="toggleAddressForm()">
            <div class="option-info">
                <span class="option-title">Delivery</span>
                <span class="option-desc">We deliver to your doorstep. A â‚±100.00 flat fee applies.</span>
            </div>
        </label>

        <div id="delivery-address-form" class="address-card" style="display: none;">
            <h3 style="font-size: 1.2rem; margin-bottom: 1.5rem;">Delivery Details</h3>
            
            {% if default_address %}
            <div class="default-address-box">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                    <strong style="color: var(--brand-dark);">Your Default Address</strong>
                    <button type="button" class="btn-card-add" onclick="useDefaultAddress()" style="font-size: 0.8rem;">
                        Use this
                    </button>
                </div>
                <p style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.4;">{{ default_address }}</p>
            </div>
            {% endif %}

            <div class="form-group">
                <label for="delivery_address">Delivery Address</label>
                <textarea id="delivery_address" name="delivery_address" class="form-control" rows="3" 
                          placeholder="House No., Street Name, Barangay, City"></textarea>
            </div>
            
            <div class="form-group">
                <label for="landmark">Landmark / Notes (Optional)</label>
                <input type="text" id="landmark" name="landmark" class="form-control" 
                       placeholder="e.g., Near the blue gate, beside 7-Eleven">
            </div>
        </div>

        <div style="margin-top: 2.5rem;">
            <button type="submit" class="btn-checkout">
                Continue to Final Review &rarr;
            </button>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
    function toggleAddressForm() {
        // Get the selected radio button
        const selectedOption = document.querySelector('input[name="order_type"]:checked').value;
        
        const addressForm = document.getElementById('delivery-address-form');
        const addressTextarea = document.getElementById('delivery_address');

        if (selectedOption === 'Delivery') {
            addressForm.style.display = 'block';
            addressTextarea.required = true; // Make address required if delivery
        } else {
            addressForm.style.display = 'none';
            addressTextarea.required = false; // Not required for pickup
        }
    }

    function useDefaultAddress() {
        // Get the default address text and put it in the textarea
        const defaultAddress = {{ default_address|tojson }}; 
        const defaultLandmark = {{ customer.landmark|tojson or '""' }}; 

        document.getElementById('delivery_address').value = defaultAddress;
        document.getElementById('landmark').value = defaultLandmark;
    }

    // Run the toggle function once on page load to set initial state
    document.addEventListener('DOMContentLoaded', toggleAddressForm);
</script>
{% endblock %}